---
import Layout from "~/layouts/BaseLayout.astro";
import { SITE } from "~/config.mjs";
import BibleShow from "~/components/partials/pages/BibleShow.svelte";
import Banner from '~/components/partials/Banner.astro'

export async function getStaticPaths() {
  const bibles = await fetch(`${SITE.apiUrl}/bibles_dbs.json`).then((response) => response.json())

  for (let i = 0; i < bibles.length; i++) {
    const bible = bibles[i];
    bibles[i].local = await fetch(`${SITE.apiUrl}/bibles/${bible.id}.json`, { method: "HEAD" })
      .then(function (response) { return response.ok })
  }

  return bibles.filter(bible => bible.local).map((bible) => { return { params: { id: bible.id } } });
}

const { id } = Astro.params;
let error
let bible
try {
  bible = await fetch(`${SITE.apiUrl}/bibles/${id}.json`)
  .then(response => response.json())
  .catch(error => console.log(error));
} catch (errorMessage) {
  error = errorMessage
}

---

<Layout>

  <BibleShow bible={bible} client:visible />
  
</Layout>
